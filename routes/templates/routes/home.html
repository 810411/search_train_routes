{% extends "base.html" %}
{% block title %}
    Поиск маршрута
{% endblock title %}
{% block content %}
    <h1 class="display-4">Поиск маршрута</h1>
    {% if routes %}
        <h3>Маршрут{% if routes|length > 1 %}ы{% endif %}
            из {{ cities.from_city }} в {{ cities.to_city }}</h3>
        <hr>
        {% for route in routes %}
            <form action="{% url 'add_route' %}" method="get">
                <input type="hidden" name="from_city" value="{{ route.from_city }}"/>
                <input type="hidden" name="to_city" value="{{ route.to_city }}"/>
                <input type="hidden" name="travel_time" value="{{ route.total_time }}"/>
                <input type="hidden"
                       name="across_cities"
                       value="
                           {% for train in route.route %}
                           {{ train.id }}
                           {% endfor %}
                       "/>
            <div>
                <h5>
                    Общее время в пути {{ route.total_time }}:
                    {% if routes|length > 1 and forloop.first %}
                        <span class="badge badge-secondary text-right">Самый короткий маршрут</span>
                    {% endif %}
                </h5>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th scope="row"></th>
                            <th>Список поездов по пути следования</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for train in route.route %}
                            <tr>
                                <th scope="row"></th>
                                <td>
                                    <a href="{% url 'trains:detail' pk=train.pk %}" class="text-dark">
                                        Поезд № {{ train.name }}, из {{ train.from_city }} в {{ train.to_city }},
                                        время в пути {{ train.travel_time }}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <button class="btn btn-dark" type="submit">Сохранить маршрут</button>
            </form>
        {% endfor %}
    {% endif %}
    <div class="row mt-3">
        <form action="{% url 'find_routes' %}" method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <input class="btn btn-dark" type="submit" value="Найти">
        </form>
    </div>
{% endblock content %}
